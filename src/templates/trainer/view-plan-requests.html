{% extends "base.html" %}

{% block title %} FitPulse | Request Workout Plan {% endblock title %}

{% block body %}
<h1 class="text-center text-3xl font-bold mb-6 text-gray-800"> Workout Plan Requests </h1>
<div id="workout-requests-table" class="flex flex-wrap gap-6 p-4 justify-center">

{% if clients_request %}
<table class="w-full max-w-4xl mx-auto border-collapse bg-white shadow-md rounded-lg overflow-hidden">
    <thead class="bg-gray-100">
        <tr>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client</th>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Timestamp</th>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Accept</th>
            <th class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Reject</th>
        </tr>
    </thead>
    <tbody class="divide-y divide-gray-200">
        {% for request in clients_request %}
            <tr>
                <td class="p-3 text-sm text-gray-700">{{ request.get_client().first_name }} {{ request.get_client().last_name }}</td>
                <td class="p-3 text-sm text-gray-700">{{ request.timestamp }}</td>
                <td class="p-3 text-sm text-gray-700">{{ request.description }}</td>
                <td class="p-3 text-sm text-gray-700">{{ request.status}}</td>
                <td class="flex gap-10 flex-row">
                    <button class="text-violet-600 hover:text-violet-700" hx-post="{{ url_for('trainer.reject_plan_request', plan_id=request.id)}}" hx-target="#plan-requests" hx-swap="innerHTML">Reject</button>
                    <button class="text-violet-600 hover:text-violet-700" hx-post="{{ url_for('trainer.accept_plan_request', plan_id= request.id)}}" hx-target="#plan-requests" hx-swap="innerHTML">Accept</button>
                </td>


                <div id="plan-requests" class="max-h-[300px] overflow-y-auto [-ms-overflow-style:'none'] [scrollbar-width:'none'] [&::-webkit-scrollbar]:hidden space-y-3">
                    {% include "components/friend_request_section.html" %}
                </div>
            </tr>
        {% endfor %}
    </tbody>
</table>

<dialog id="modal-exercise-content" class="w-full md:w-2/3 mx-auto focus-visible:outline-none">

</dialog>

<script>
    document.addEventListener('htmx:afterSwap', function (event) {
        if (event.target.id === 'modal-exercise-content') {
            const modal = document.getElementById('modal-exercise-content');
            modal.showModal();

            const closeButton = modal.querySelector('#modal-close-button');
            closeButton.addEventListener('click', function () {
                modal.close();
            });
        }
    });

    document.getElementById('modal-exercise-content').addEventListener('click', function (event) {
        const modal = event.target;
        if (modal.tagName === 'DIALOG' && event.target === modal) {
            modal.close();
        }
    });

    document.addEventListener('keydown', function (event) {
        if (event.key === 'Escape') {
            const modal = document.getElementById('modal-exercise-content');
            modal.close();
        }
    });
</script>

{% else %}

<p class="text-center text-gray-600"> No requests are sent to you</p>

{% endif %}
</div>
{% endblock body %}